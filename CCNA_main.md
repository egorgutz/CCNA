# Конспект CCNA - устное руководство
## Модели объединенных сетей
**OSI**(open system interconnections "Взаимодействие открытых систем"). Цель разработки состояла в том, что-бы способствовать созданию, сетевых устройств, которые могли бы функционировать в единой среде.

## Многоуровневый коммуникационный подход
**Базовая модель**(reference model) является основой коммутационного процесса. Она определяет все задачи, решаемые при организации эффективного взаимодействия систем, группируя их по уровням (layer). Система разработанная с учетом модели, имеет многоуровневую архитектуру (layered architecture).

### Достоинства базовой модели
Основной целью любой модели является совместимость оборудования разных производителей. 
1. Деление сложных сетевых операций на легко управляемые уровни.
2. Измененния на одном уровне не действуют на другие уровни, что позволяет разработчикам приложений специализироваться на решении отдельных задач.
3. Определение стандартных интерфейсов для простой интеграции оборудования различных компаний.
   
## Базовая модель **OSI**
Модель содержит спецификации и формирует каркас (framework) для создания и внедрения сетевых стандартов, устройств и схем объединения сетей. 

## Уровень и краткое описание:
### 7. Приложений 
Интрерфейсы и визуальные окружения
### 6. Представлений 
Форматирует данные, архивация, кодирование, де-кодирование 
Работает с форматами:.jpg; .tiff; .midi; .mpeg 
### 5. Сеансовый 
  Управляет диалогом между устройствами, взаимодействие может происходить в трех режимах: 
   1. симплексном (simplex) 
   2. полудуплексном (half-duplex) 
   3. полнодуплексном (full-duplex)  

Протоколы: 
NFS (Network File System) - протокол создания удаленного доступа для пользователей 
SQL (Structured Query Language) - язык структурированных запросов
RPC (Remote Procedure Call) - вызов удаленных процедур

### 4. Транспортный уровень
Cегментирование и сборка данных, TCP/UDP.

**Управление потоком:** 
Не позволяет хосту-отправителю передавать данные так, чтобы переполнялись буферы обмена получателя. Доставка данных гарантируется тем, что: 
    * Отправитель получает подтверждение от принимающей стороны о доставке сегментов данных
    * Любые неподтвержденные сегменты передаются повторно
    * Принятые сегменты упорядочиваются в соответствии с последовательностью их передачи
    * Во избежании перегрузки сети, переполнения буферов и потери данных используется управление потоком данных

**Коммуникации, ориентированные на создание соединений:**
 По запросу одного из хостов производится установление соединение. Прикладные программы обоих хостов начинаются с уведомления своих операционных систем о необходимости установки соединения. Операционные системы обмениваются сообщениями, подтверждающими согласие и готовность обеих сторон начать обмен данными. После завершения синхронизации соединение считается установленным, и начинается процесс передачи данных. Во время передачи обе машины переодически проверяют друг друга, через ПО протокола.

**Шаги установления соединения:**
* Первый сегмент "согласие на установку соединения" является запросом на синхронизацию.
* Вторым и третьим сегментами подтверждается получение запроса и определяются параметры соединения между хостами.
* Последний  сегмент также является подтверждением, оповещающим получателя о том, что достигнуто согласие на установление соединения и что соединение установленно.
  
Во время передачи информации может возникнуть ситуация когда один из участников может создать трафика больше, чем может принять другой хост или пропустить канал. Эту проблему решает Буферизация, но только в том случае если поток носит лавинных характер, в противном случае буферная память переполнится. В случае большого "наплыва трафика" протокол транспортного уровня отправляет сообщение хосту-источника о неготовности приема, после разгрузки буфера поступит сообщение о возможности передачи. А во избежании повреждений при гарантированной отправке используется подтверждение о получении.

**Использование окон**
Пропускная способность уменьшилась бы, если передающих хост ожидал подтверждения на каждый посланный сегмент, по этому хост отправитель использует время между отправкой одного сегмента и его подтверждением хостом получателем для отправки новых данных. Число сегментов которые можно послать без подтверждения их доставки называются **"окном"**.

**Подтверждение**
Надежность доставки обеспечивается применением метода "положительного подтверждения с повтором передачи". Принимающая машина отсылает передающей подтверждения о получении данных. При отправке сообщения запускается таймер ожидания получения подтверждения, если ответ не получен сегмент отправляется заново.

### 3.  Сетевой уровень 
Отвечает за маршрутизацию в объединенной сети и сетевую адресацию, т.е. за пересылку трафика между устройствами, которые не подключены локально. Маршрутизаторы (router) или иные устройства уровня 3 действуют на сетевом уровне и обеспечивают в объединенной сети службу маршрутизации. 
Когда в интерфейс маршрутизатора поступает пакет, проверятся ip-адрес назначения. Если пакет не направлен самому маршрутизатору, то это устройство ищет в своей таблице маршрутизации целевой адрес сети назвначения. После этого выбирается выходной интерфест для пакета. После деления на кадры пакет пересылается за пределы локальной сети. Если же в таблице маршрутизации не будет найдена сеть назначения, то пакет будет отброшен. 

На сетевом уровне используется два типа пакетов:
* Данных
* Путей (маршрутов)

**Пакеты данных** - Используются для пересылки пользовательской информации через сеть. Применяемые для этого протоколы называются маршрутизируемыми протоколами. 

**Пакеты обновления маршрутов** - Служат для уведомления соседних маршрутизаторов о подключенных сетях, известных маршрутизатору объединенной сети. Пакеты обновления маршрутов помогают создавать и поддерживать таблицы маршрутизации во всех маршрутизаторах.

**Таблицы маршрутизации** 
Содержат следующую информацию
* Сетевой адрес - сетевой адрес конкретного протокола. Маршрутизатор обязан поддерживать отдельные таблицы для каждого протокола маршрутизации, поскольку каждый протокол маршрутизатора придерживаться собственной схемы адресации.
* Интерфейс - Выходной интрейс для пакета, отправляемого в определенную сеть. 
* Метрика - Расстояние до удаленной сети. разные протоколы маршрутизации пользуются различными методами для вычисления этого расстояния. 

Маршрутизаторы делят сеть на *широковещательные* домены, т.е. по умолчанию широковещательные рассылки не проходят сквозь маршрутизаторы. Кроме того, маршрутизаторы делят сеть на домены коллизии (конфликтов), что реализуется переключателями на уровне 2. Каждый интерфейс связан с отдельной сетью и имеет уникальный идентификатор этой сети. Все хосты такой сети, к которым подключается маршрутизатор, будут иметь одинаковые сетевые номера. 

Особенности маршрутизаторов:
* По умолчанию маршрутизаторы не пересылают никаких широковещательных или многоадресных пакетов. 
* Маршрутизаторы пользуются логическим адресом сети из заголовка сетевого уровня для определения следующего участка при пересылке пакета.
* Маршрутизаторы могут использовать списки доступа, созданные администратором сети, для управления защитой от пакетов, пытающихся попасть или покинуть интерфейс. 
* Маршрутизаторы обеспечивают функции моста на уровен 2, если это необходима. Кроме того он может выполняться в данном интерфейсе одновременно с маршрутизацией. 
* Устройства уровня 3 обеспечивают соединения между виртуальными локальными сетями **Vlan**.
* Маршрутизаторы могут поддерживать определенное значение качества обслуживания QoS (Quality of Service) для отдельных типов сетевого трафика.

### 2. Канальный уровень 
(Data Link Layer или уровень связи данных) обеспечивает доставку сообщения на правильное устройство и трансляцию содержимого сообщения с сетевого уровня в биты физического уровня для последующей пересылки по сети. Происходит форматирование сообщения в кадры данных и добавление настроенного заголовка, содержащего ареса источника и назначения. Эта добавленная информация является своеобразной капсулой, заключающей в себе исходное сообщение также как капсулы спутников вмещают в себя двигатели, навигационное оборудование и другие приборы. Маршрутизатор сетевого уровня не заботится о достижении конкретного хоста, поскольку должен передать данные только в определенную сеть. Идентификация каждого утсройства в локальной сети проиcходит на канальном уровне. Канальный уровень использует аппаратную адресацию.  Каждый пакет делится на кадры с управляющей информацией, однако эта информация удаляется на принимающем маршрутизаторе, который оставляет только исходный пакет. 
   
Канальный уровень делится на два подуровня:
* Управление доступом к носителю MAC (Media Access Control) Определяет способ внедрения пакетов в среду передачи. На этом уровне устанавливаются правила для линии связи, уведомлениях об ошибках, последовательности доставки, а так же средствах управления протоколом.
* Управление логическими связями LLC (Logical link Control) Этот подуровень отвечает за идентификацию протоколов сетевого уровня и выполнение инкапсуляции данных. Заголовок LLC указывает канальному уровню на порядок обработки пакет после получения его кадров. 

**Переключатели и мосты канального уровня**
Переключатели и мосты работают на канальном уровне и производят фильтрацию сетевого трафика с помощью аппаратных (MAC) адресов. Переключение (коммутация) на уровне 2 может считаться аппаратно реализованной функцией мостов, поскольку используются специальные микросхемы ASIC (*Application-Specific Integrated Circuits* интегральные микросхемы специализированного применения). Микросхемы способны работать с гигабитовыми скоростями и малыми задержками.
Переключатели и мосты читают каждый входящий в сеть кадр. Устройства уровня 2 добавляют в таблицу фильтрации аппаратный адрес источника из кадра, чтобы отслеживать порт, который получает данную последовательность кадров. Переключатель должен точно знать о местоположении устройства. 

После создания таблицы фильтрации устройством уровня 2, сетевое устройство начинает только пересылать кадры в сегмент сети, где находится аппаратный адрес точки назначения. Если устройство назначения присутствует в этом же сегменте, что и кадр, то устройство уровня 2 блокирует распространение этого кадра в другие сегменты сети. Если же точка назначения находится в ином сегменте, то кадр только пересылается в подобный сегмент без какой-либо обработки. Этот процесс называется прозрачным исполнением функции моста (transparent bridging, прозрачным мостованием).

Если кадр попадает в интерфейс устройства уровня 2 (переключателя) и в таблице фильтрации неизвестен аппаратный адрес точки назначения, то устройство пересылает кадр во все подключенные сегменты. Если на этот кадр откликнется "неизвестное" переключателю устройство, то переключатель обновит свою таблицу фильтрации, добавив в нее полученные сведения об откликнувшемся устройстве. Адрес в пересылаемом кадре иногда является адресом широковещательной рассылки. В этом случае переключатель по умолчанию формирует широковещательные рассылки во всех подключенных сегментах. 

Устройства, которые получают широковещательную рассылку, считаются принадлежащими одному широковещательному домену. Устройство уровня 2 распространяет далее шторм широковещательных рассылок на уровне 2. Единственным способом устранения такого шторма на все объединенные сети являются устройства уровня 3. 

Основное преимущество переключателей в сравнении с концентраторами состоит в том, что в объединенной сети каждый коммутируемый порт образует собственный домен коллизий, а концентратор объединенной сети формирует один общий домен конфликтов. Заметим, что переключатели и мосты не разделяют на части широковещательные домены, поскольку распространяют все широковещательные рассылки. 
Еще одно преимущество переключателей в локальной сети в сравнении с концентраторами является то, что каждое устройство любого сегмента может осуществлять передачу данных независимо от других устройств. Каждый сегмент становится отдельным доменом конфликтов. Концентраторы позволяют в определенный момент времени передавать данные только одному устройству в сети. 

Переключатели не могут транслировать данные в ностели разного типа, т.е. каждое подключенное к переключателю устройство должно применять одинаковый тип кадров. Если нужно подключить переключатель Token Ring или другую локальную сеть, то нужен маршрутизатор. 

### 1. Физический уровень 
Отвечает за передачу и прием битовых потоков. Биты могут иметь значения 0 или 1 подобно коду Морзе, но с числовыми значениями. Физический уровень взаимодействует с разными типами коммуникационных носителей, что приводит к различному представлению битовых значений. Иногда применяются тональные сигналы, но чаще битовые значения представлены переходами между состояниями - изменениями напряжения от низкого к высокому потенциалу или наоборот. Физический уровень специфицирует электрические, механические, процедурные и функциональные характеристики, необходимые в процессе активизации, обслуживания и деактивации физических соединений между системами. На физическом уровне определен интерфейс между оконечным оборудованием данных (DTE) и оборудованием цепей передачи данных (DCE). Если оборудование цепей передачи данных расположено у провайдера то оборудование данных являются подключенные устройства пользователей. 

**Концентраторы на физическом уровне**
Концентратор - это многопортовый повторитель. Это устройство получает цифровой сигнал и усиливает, либо регенерирует его перед пересылкой во все активные порты устройства, не выполняя анализа данных. Так же поступает активный концентратор. Полученный сегмент цифрового сигнала передается после усиления или регенерации с входного на все активные выходые порты концентратора. Любое подключенное к концентратору устройство находится в одном и том же домене конфликтор, а также в том же самом домене широковещательных рассылок. Домен широковещательных рассылок определяет область сети, где все устройства сегмента "слушают" все подобные рассылки. Концентратор так же как повторитель не анализирует сетевой трафик. 

## Сети Ethernet 
*Ethernet* - это метод доступа к коммуникационному носителю, позволяющий всем хостам сети совместно использовать одну полосу пропускания линии связи. Популярность обусловлена простотой реализации, диагностики и расширения. 
В сетях Ethernet используется метод доступа CSMA/CD (Carrier Sense Multiple Access with Collision Detect, множественный доступ с контролем несущей и определением конфликтов). Он позволяет совместно использовать полосу пропускания так, что никакие два устройства не могут одновременно осуществлять доступ к сетевому носителю. Метод CSMA/CD создан для решения проблем с конфликтами при доступе к носителю (коллизиями), когда происходит одновременная пересылка пакетов в разные узлы. Важно управлять конфликтами, когда один из узлов в методе CSMA/CD начинает пересылку данных по сети, все остальные узлы обязаны принимать передаваемую информацию и анализировать получаемые данные. 

**Описание метода:** Когда хост собирается передавать данные по сети. он сначала проверяет наличие в линии цифрового сигнала. Если *линия* чистая (не передает данные ни один из хостов), то хост начинает пересылку данных. После этого хост уже не должен останавливаться. Передающий хост постоянно проверяет состояние линии, чтобы гарантировать отсутствие передачи данных другими хостами. Если хост замечает в линии сигнала от другого хоста, то первый хост посылает сигнал "помеха" (jam), который приводит к остановке передачи данных всеми хостами в сегменте. Сетевые узлы реагируют на сигнал тем, что выжидают некоторое время перед следующей попыткой начала пересылки данных. 

Алгоритм отката после сигнала "помеха" предписывает время начала повторной пересылки данных для всех станций в сегменте конфликта. Если окажутся неудачными 15 попыток выхода из конфликта между станциями, узел регистрирует состояние тайм-аута (time-out).

## Дуплексная и полудуплексная сеть Ethernet 
**Полудуплексная сеть** *Ethernet* определена в исходном стандарте 802.3, где предписано использование только одной пары проводников для пересылки цифровых сигналов в обоих направлениях. В таких сетях используется метод CSMA/CD для предотвращения конфликтов и выполнения повторных пересылок информации при обнаружении конфликта. 
Если концентратор подключен к переключателю, то он должен работать в полудуплексном режиме, поскольку станция не способно выявить конфликт доступа к носителю. Полудуплексная передача эффективна на 50-60% в больших сетях 10BaseT удается получить только 3-4 мб/с. 

**Дуплексная** (полнодуплексная сеть) *Ethernet* использует две пары проводников вместо одной пары в полудуплексных сетях. В дуплексном режиме применяется соединение "точка-точка" между передающим и принимающим устройством. Конфликтов не возникает ,поскольку мы получаем несколько путей пересылки данных вместо одного пути в полудумлексном режиме. Дуплексная *Ethernet* обеспечивает 100% эффективности в обоих направлениях, т.е. мы можем достичь скорости в 20мб/с в Ethernet. Эта скорость называется композитной (aggregate rate). 
После подачи питания на порт дуплексной *Ethernet*, он соединяется с оконечным портом и согласовывает с ним связь по протоколу *Fast-Ethernet*. Этот процесс называется механизмом автоопределения (auto-detect mechanism). Такой механизм предполагает предварительное согласование уровня обмена, т.е. выбор режима согласования уровня обмена т.е. выбор режима 10 или 100 мб/с. Если это неприемлемо для одного из портов то обмен осуществяется в полудуплексном режиме. 

## Ethernet на канальном уровне
*Ethernet* на канальном уровне отвечает за адресацию в рамках протоколов, что обычно связано с аппаратными адресами (MAC-адресами). *Ethernet* так же отвечает за разделения на кадры пакетов. полученных от сетевого уровня, и за подготовку кадров к пересылке по локальной сети с помощью определенного в стандарте метода доступа к носителю. 

Существует четыре типа кадров Ethernet:
* Ethernet_II
* IEEE 802.3
* IEEE 802.2
* SNAP
  
### Адресация Ethernet 
Адресация *Ethernet* использует MAC-адреса (Media Access Control, управление доступом к носителю) которые "прошиты" в каждой плате сетевого адаптера NIC (Network Interface Card, карта сетевого интерфейса). MAC состоит из 48 разрядов и имеет канонический формат, гарантирующий, по крайней мере, одинаковый формат записи адерсов для всех известных технологий локальных сетей. 

Уникальный идентификатор организации OUI (Organizationally Unique Identifer) присваивается институтом IEEE каждой компании-производителю (24 разряда или 3 байта). В свою очередь, организация присваивает глобально администрируемый адрес (globally administered address), который имеет длину 24 разряда (3 байта) и является уникальным для всех сетевых адаптеров данной компании. Разряд 46 должен иметь значение 0 для глобального присвоения производителем и значение 1 при локальном управлении адресами сетевым администратором.

L/G - локальный/глобальный
L/G | L/G | Уникальный идентификатор организации | Идентификатор присвоенный производителем

### Кадры Ethernet 
Канальный уровень отвечает за объединение битов в байты, а байтов в *кадры* (frame). Кадры используются на канальном уровне для инкапсуляции пакетов, пришедших с сетевого уровня, и последующей пересылки пакетов по носителю. 

Три вида носителей (методов доступа к носителю):
* С соревнованием (Ethernet)
* Передачи маркера (Token Ring и FDDI)
* Голосования (большие ЭВМ от IBM)

Станция сети Ethernet пересылает кадры данных другой станции с помощью группы битов (форм кадра MAC). Это обеспечивает выявление ошибок с помощью циклической избыточной проверки CRC (cyclic redundancy check), выполняется только выявление ошибок без коррекции.

Форма кадров:

```wavedrom
{ signal: [{ name: "Ethernet_II", wave: "x=..=.=.==.x", data: ["Preamble 8byte", "DA 6byte", "SA 6byte", "data", "FS 4byte"]  }] }
```

```wavedrom
{ signal: [{ name: "802.3_Ethernet", wave: "x=..=.=.==.x", data: ["Preamble 8byte", "DA 6byte", "SA 6byte", "data", "FS 4byte"]  }] }
```
**Преамбула (Preamble)**
Чередующийся шаблон нулей и единиц обеспечивает частоту 5 МГц в начале каждого пакета. Это позволяет принимающий устройствам настроится на следующий далее битовый поток. В преамбуле применяется поле SFD или синхронизации (synch) для указания принимающей станции на начало секции данных в сообщении.

**SFD (Start Frame Delimiter, разделитель начала кадра)/Synch**
SFD состоит из 1,0,1,0,1,0 и.т.д., а поле (synch) - из всех единиц. Поле преамбулы вместе с полем SFD/synch занимают 64 разряда.

**Адрес назначения DA (Destination Address)**
 В этом поле располагается 48-разрядное значение, записанное методом "первый LSB" (Least Significant Bit, наименее значимый бит). DA нужно принимающей станции для определения, послан ли следующий далее пакет данному узлу. 
Адрес назначения может быть:
* Индивидуальным
* Многоадресным
* Широковещательным MAC - адресом

При широковещательной рассылке в поле адреса назначения установлены все единицы (все F) что определяет заданные устройства. Многоадресная рассылка поступает только отдельному подмножеству узлов в сети. 

**Адрес источника SA (Source Address)**
Поле SA (Source Address) хранит 48-разрядный МАС-адрес, предоставленный передающим устройством. Адрес записан методом "первым LSB". Широковещательные и многоадресные рассылки не могут быть записаны в поле SA. 

**Поля длины или типа**
В 802.3 используется поле длины, но в кадрах *Ethernet* находится поле типа, определяющее протокол сетевого уровня. 802.3 не допускает идентификации протокола верхнего уровня т.к. эта спецификация применяется в лицензированных локальных сетях IPX.

**Данные**
В этом поле находится пакет данных, поступивший в канальный уровень с сетевого уровня. Длина поля может составлять *46 - 1500* байт. 

**Контрольная последовательность кадра FCS (Frame Check Sequence)**
Поле FCS находится в конце кадра и служит для хранения суммы CRC.

#### 802.2 и SNAP
Кадры 802.3 Ethernet не могут самостоятельно указать протокол верхнего (сетевого) уровня нужна дополнительная информация, которая (а так же дополнительные данные) определена в стандарте 802.2 LLC института IEEE.

Кадр IEEE 802.3 и LLC(802.2) и тип кадра SNAP Subnetwork Architecture Protocol (протокол архитектуры подсетей).
**802.2 (SNAP)**
1|1|1 или 2|3|2|Переменная длинна|
-|-|-|-|-|-|
Адрес назначения SAP=AA|Адрес источника SAP=AA | Контрольное поле 03 | Идентификатор OUI | Тип | Данные

**802.2 (SAP)**
1 | 1 | 1 или 2 | Переменная длина | 
-|-|-|-|
Назначения SAP | Источник SAP | Контрольное поле | Данные |

Cisco пользуется кадрами **SNAP** для собственного лицензированного CDP (Cisco Discovery Protocol - протокол обнаружения Cisco)

### Ethernet на физическом уровне
В среде Ethernet с совместно используемыми концентраторами начало передачи данных одной станцией предполагает синхронизацию всех устройств на передаваемый цифровой сигнал и формат пересылаемого по линии кадра. Все устройства используют один физический носитель и прослушивают кадры в пределах одного домена конфликтов. В любой момент времени передачу может осуществлять только одно устройство. Все остальные устройства сетевого сегмента должны синхронизироваться по пересылаемому сигналу и кадру. Если одновременно два устройства начинают передачу, то возникает конфликт (коллизия). В 1984 IEEE утвердил протокол (метод) *Carrier Sense Multiple Access with Collision Detect (CSMA/CD)*. Этот протокол в основном предписывает режим прослушивания линии всем остальным устройствам, чтобы выявить начало передачи данных и остановить в случае конфликта собственную процедуру передачи с ожиданием следующей попытки в течении предписанного времени. 

В *Ethernet* определена технология передачи в основной полосе частот (baseband technology) во время передачи данных станция использует всю доступную полосу пропускания линии и не предполагает ее разделение с другими устройствами. 

**Стандарты IEEE 802.3:**
* **10Base2** Скорость передачи 10 Мб/c технология передачи в основной олосе частот, длинна линии до 185 метров. *Тонкая Ethernet (thinnet).* В основном сегменте поддерживается до 30 рабочих станций.
* **10Base5** Скорость передачи 10 Мб/с технология передачи в основной полосе частот, длина линии до 500 метров. *Толстая Ethernet (thicknet).*
* **10BaseT** Скорость передачи 10 Мб/с по витым парам категории 3. В отличие от сетей *10Base2 ; 10Base5*, каждое устройство подключается к концентратору или к переключателю, а в одном сегменте или линии моет быть только один хост.

Во всех 802.3 определен интерфейс подключения элемента AUI (Attachment Unit Interface), что позволяет побитовую пересылку данных на физическом уровне с помощью метода доступа, определенного на канальном уровне. MAC - адреса остаются неизменными, но на физическом уровне можно поддерживать любую существующую или новую технологию. 

AUI определяет 15-контактный соединитель, что позволяет приемо-передатчику (thansceiver, transmitter/receiver) обеспечить соединение между 15-контактным разъемом и витыми парами. Интерфейс AUI встроен в приемо-передатчик. а в качестве соединителей используются разъемы *RG-45*.

Интерфейс AUI не поддерживает 100 МБ/с Ethernet, поскольку необходима высокая частота передачи данных. Для 100BaseT требуется новый интерфейс, который определен в спецификации 802.3u - интерфейс независимого носителя МП (Media Independent Interface). Он обеспечивает пропускную способность 100 Мб/с. Интерфейс МП определяет нибблы (nibble, группы из четырех битов). В GigabitEthernet применяется интерфейс независимого гигабитного носителя GMII (Gigabit Media Independent Interface), где одновременно передается 8 бит.

### Инкапсуляция данных
